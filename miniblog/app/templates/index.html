{% extends 'base.html' %}

{% block head %} 
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}"> 
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chatbot.css') }}">
{% endblock%}

{%block conteudo %}

    <main>


        <div class = "presentation">
            
                <div class="presentation-item">
                    <h2>Emma's Bookstore</h2>
                    
                </div>  
                <div class="presentation-item">
                    <a class="button-shop" href="/shop">Shop Now</a> 
                </div> 

            </div>
             
        </div>

        <div class="section-categories">
            <h2>CATEGORIES</h2>
            <div class="section-categories-itens">
                <div class="category">
                    <img src="{{ url_for('static', filename='img/books.jpg') }}" alt="category1">
                    <h3>Books</h3>
                </div>
                <div class="category">
                    <img src="{{ url_for('static', filename='img/books.jpg') }}" alt="category2">
                    <h3>Technology</h3>
                </div>
                <div class="category">
                    <img src="{{ url_for('static', filename='img/books.jpg') }}" alt="category3">
                    <h3>Travel</h3>
                </div>
                <div class="category">
                    <img src="{{ url_for('static', filename='img/books.jpg') }}" alt="category4">
                    <h3>Food</h3>
                </div>
                <div class="category">
                    <img src="{{ url_for('static', filename='img/books.jpg') }}" alt="category5">
                    <h3>Music</h3>
                </div>
                <div class="category">
                    <img src="{{ url_for('static', filename='img/books.jpg') }}" alt="category6">
                    <h3>Health</h3>
                </div>
            </div>
            
        </div>

        <div class="section-library">
            <h2>FAVORITE BOOKS</h2>
            <div class="section-books">
                <div class="book">
                    <img src="{{ url_for('static', filename='img/books.jpg') }}" alt="book1">
                    <h3 class="card-title">Orgulho e Preconceito</h3>
                    <p>Jane Austen</p>
                    <div class="container-price">
                        <p class="card-price">R$ 29,90</p>
                        <button class="button-cart">Adicionar</button>
                    </div>
                    

                </div>
                <div class="book">
                    <img src="{{ url_for('static', filename='img/books.jpg') }}" alt="book2">
                    <h3 class="card-title">1984</h3>
                    <p>George Orwell</p>
                    <div class="container-price">
                        <p class="card-price">R$ 39,90</p>
                        <button class="button-cart">Adicionar</button>
                    </div>

                </div>
                <div class="book">
                    <img src="{{ url_for('static', filename='img/books.jpg') }}" alt="book1">
                    <h3 class="card-title">O Alquimista</h3>
                    <p>Paulo Coelho</p>
                    <div class="container-price">
                        <p class="card-price">R$ 34,90</p>
                        <button class="button-cart">Adicionar</button>
                    </div>

                </div>
                <div class="book">
                    <img src="{{ url_for('static', filename='img/books.jpg') }}" alt="book2">
                    <h3 class="card-title">Dom Quixote</h3>
                    <p>Miguel de Cervantes</p>
                    <div class="container-price">
                        <p class="card-price">R$ 49,90</p>
                        <button class="button-cart">Adicionar</button>
                    </div>

                </div>
                <div class="book">
                    <img src="{{ url_for('static', filename='img/books.jpg') }}" alt="book1">
                    <h3 class="card-title">O Senhor dos Anéis: A Sociedade do Anel</h3>
                    <p> J.R.R. Tolkien</p>
                    <div class="container-price">
                        <p class="card-price">R$ 64,90</p>
                        <button class="button-cart">Adicionar</button>
                    </div>

                </div>
                <div class="book">
                    <img src="{{ url_for('static', filename='img/books.jpg') }}" alt="book2">
                    <h3 class="card-title">Harry Potter e a Pedra Filosofal</h3>
                    <p>J.K. Rowling</p>
                    <div class="container-price">
                        <p class="card-price">R$ 44,90</p>
                        <button class="button-cart">Adicionar</button>

                    </div>
                </div>
    
                
                
            </div>
        </div>
        

      

    </main>

    <div class="chatbot-widget">
        <button id="chatbot-toggle">Chat</button>
        <div class="chatbot-container" id="chatbot-container">
            <div class="chat-log" id="chatLog">
                <div class="chatbot-message">Olá! Como posso ajudar?</div>
            </div>
            <div class="input-area">
                <input type="text" id="mensagemUsuario" placeholder="Digite sua mensagem...">
                <button onclick="enviarMensagem()">Enviar</button>
            </div>
        </div>
    </div>

    <script>
        const chatbotToggle = document.getElementById('chatbot-toggle');
        const chatbotContainer = document.getElementById('chatbot-container');
        const chatLog = document.getElementById('chatLog');
        const mensagemInput = document.getElementById('mensagemUsuario');

        chatbotToggle.addEventListener('click', () => {
            chatbotContainer.classList.toggle('active');
        });

        function enviarMensagem() {
            const mensagem = mensagemInput.value.trim();

            if (mensagem) {
                chatLog.innerHTML += `<div class="user-message">${mensagem}</div>`;
                mensagemInput.value = '';

                let dataToSend = { mensagem: mensagem };
                if (mensagem.startsWith('/')) {
                    dataToSend.comando = mensagem.substring(1); // Envia o comando sem a barra
                }

                fetch('/enviar_mensagem', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json', // Melhor usar JSON pra mandar mais informações
                    },
                    body: JSON.stringify(dataToSend), // Envia os dados como JSON
                })
                .then(response => response.json())
                .then(data => {
                    chatLog.innerHTML += `<div class="chatbot-message">${data.resposta}</div>`;
                    chatLog.scrollTop = chatLog.scrollHeight;
                })
                .catch(error => {
                    console.error('Erro ao enviar mensagem:', error);
                    chatLog.innerHTML += '<div class="chatbot-message error">Erro ao obter resposta.</div>';
                    chatLog.scrollTop = chatLog.scrollHeight;
                });
            }
        }

        // Enviar mensagem de boas-vindas ao abrir o chatbot
        document.addEventListener('DOMContentLoaded', () => {
            fetch('/enviar_mensagem', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ mensagem: 'Olá' }), // Envia como JSON também
            })
            .then(response => response.json())
            .then(data => {
                chatLog.innerHTML += `<div class="chatbot-message">${data.resposta}</div>`;
                chatLog.scrollTop = chatLog.scrollHeight;
            })
            .catch(error => {
                console.error('Erro ao enviar mensagem de boas-vindas:', error);
                chatLog.innerHTML += '<div class="chatbot-message error">Erro ao obter resposta de boas-vindas.</div>';
                chatLog.scrollTop = chatLog.scrollHeight;
            });
        });

        // Adiciona evento de tecla "Enter" para enviar mensagem
        mensagemInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter' && chatbotContainer.classList.contains('active')) {
                enviarMensagem();
            }
        });
    </script>
   
    
{%endblock%}